<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Cobra Test</title>
    <style>
        body { margin: 0; background: #001133; font-family: monospace; }
        #info { position: absolute; top: 10px; left: 10px; color: #00ff00; background: rgba(0,0,0,0.7); padding: 10px; }
    </style>
</head>
<body>
    <div id="info">
        <h3>Working Cobra Test</h3>
        <p>Status: <span id="status">Loading...</span></p>
        <p>Model: <span id="debug">-</span></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r110/three.min.js"></script>

    <script>
        // Embed the Cobra data directly to avoid CORS issues
        const cobraData = {
            vertices: [
                0, 2.769230842590332, 0,
                2.9538462162017822, -0.0923076942563057, 6,
                -2.9538462162017822, -0.0923076942563057, 6,
                2.9538462162017822, -2.769230842590332, -6,
                -2.9538462162017822, -2.769230842590332, -6,
                -8.123077392578125, 1.8461538553237915, -6,
                -11.076923370361328, -0.5538461804389954, -2.4000000953674316,
                -12, -0.5538461804389954, -6,
                8.123077392578125, 1.8461538553237915, -6,
                11.076923370361328, -0.5538461804389954, -2.4000000953674316,
                12, -0.5538461804389954, -6,
                0, 2.769230842590332, -6
            ],
            // Create proper triangle indices manually based on Cobra shape
            indices: [
                // Front triangular faces
                0, 1, 2,   // top front triangle

                // Main body triangles
                1, 3, 8,   // right side
                2, 5, 4,   // left side

                // Wing triangles
                1, 8, 9,   // right wing front
                9, 10, 3,  // right wing back
                2, 6, 5,   // left wing front
                6, 7, 4,   // left wing back

                // Rear triangles
                3, 10, 11, // right rear
                4, 11, 7,  // left rear

                // Top/bottom closure
                0, 11, 8,  // top rear
                0, 5, 11,  // top left

                // Additional faces for proper closure
                8, 11, 9,  // right top
                9, 11, 10, // right rear top
                5, 6, 11,  // left top
                6, 7, 11   // left rear top
            ]
        };

        let scene, camera, renderer, cobra;

        function init() {
            console.log('ðŸš¢ Starting working cobra test...');

            try {
                // Basic Three.js setup
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x001133);

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(15, 8, 15);
                camera.lookAt(0, 0, 0);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                // Add lights
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(20, 20, 10);
                scene.add(directionalLight);

                document.getElementById('status').textContent = 'Creating Cobra geometry...';

                // Create geometry from embedded data
                const geometry = new THREE.BufferGeometry();

                // Set vertices
                const vertices = new Float32Array(cobraData.vertices);
                geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));

                // Set indices for triangular faces
                const indices = new Uint16Array(cobraData.indices);
                geometry.setIndex(indices);

                // Compute normals
                geometry.computeVertexNormals();

                console.log('âœ… Geometry created:');
                console.log('- Vertices:', vertices.length / 3);
                console.log('- Triangles:', indices.length / 3);

                // Create materials
                const solidMaterial = new THREE.MeshLambertMaterial({
                    color: 0x666666,
                    side: THREE.DoubleSide
                });

                const wireframeMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ff88,
                    wireframe: true,
                    transparent: true,
                    opacity: 0.7
                });

                // Create meshes
                const solidMesh = new THREE.Mesh(geometry, solidMaterial);
                const wireframeMesh = new THREE.Mesh(geometry, wireframeMaterial);

                // Create group
                cobra = new THREE.Group();
                cobra.add(solidMesh);
                cobra.add(wireframeMesh);

                scene.add(cobra);

                document.getElementById('status').textContent = 'Cobra loaded successfully! âœ…';
                document.getElementById('debug').textContent = `${vertices.length/3} vertices, ${indices.length/3} triangles`;

                console.log('âœ… Working Cobra mesh created and added to scene');

                // Add mouse controls
                setupControls();

                // Start animation
                animate();

            } catch (error) {
                console.error('âŒ Error:', error);
                document.getElementById('status').textContent = `Error: ${error.message}`;
            }
        }

        function setupControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;

            document.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            document.addEventListener('mouseup', () => {
                isMouseDown = false;
            });

            document.addEventListener('mousemove', (event) => {
                if (!isMouseDown || !cobra) return;

                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;

                cobra.rotation.y += deltaX * 0.01;
                cobra.rotation.x += deltaY * 0.01;

                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            document.addEventListener('wheel', (event) => {
                const zoomFactor = 1 + event.deltaY * 0.001;
                camera.position.multiplyScalar(zoomFactor);
                camera.position.clampLength(5, 50);
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            if (cobra) {
                cobra.rotation.y += 0.005; // Slow auto-rotation
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>