<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shader Fix Test</title>
    <style>
        body { margin: 0; background: #001; color: #0f0; font-family: monospace; }
        #info { position: absolute; top: 10px; left: 10px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 10px; }
    </style>
</head>
<body>
    <div id="info">
        <div>SHADER FIX TEST</div>
        <div>Should see colored terrain in shader mode, not black</div>
        <div>Press B = Shader Mode, V = Wireframe</div>
        <div id="status">Loading...</div>
    </div>

    <script src="https://unpkg.com/three@0.149.0/build/three.min.js"></script>
    <script src="js/simple_terrain_fix.js"></script>

    <script>
        let scene, camera, renderer, terrain;
        const status = document.getElementById('status');

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000020);

            // Camera positioned to see terrain
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 100000);
            camera.position.set(0, 2000, 3000); // Higher up to see terrain
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting for shader visibility
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);

            // Create terrain in shader mode
            if (window.SimpleTerrain) {
                terrain = new window.SimpleTerrain(scene);
                terrain.wireframeMode = false; // Start in shader mode
                terrain.createTerrain();
                
                status.textContent = `Terrain: ${terrain.wireframeMode ? 'Wireframe' : 'Shader'} mode - ${terrain.shaderMaterial ? 'Custom Shader' : 'Fallback Material'}`;
                
                console.log('Terrain created:', {
                    visible: terrain.isVisible,
                    wireframe: terrain.wireframeMode,
                    shaderMaterial: !!terrain.shaderMaterial,
                    children: terrain.terrainGroup.children.length
                });
            } else {
                status.textContent = 'ERROR: SimpleTerrain not found';
            }

            // Controls
            document.addEventListener('keydown', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'b':
                        if (terrain) {
                            console.log('Switching to shader mode...');
                            terrain.setVisualizationMode('shader');
                            status.textContent = `Shader mode - ${terrain.shaderMaterial ? 'Custom Shader' : 'Fallback Material'}`;
                        }
                        break;
                    case 'v':
                        if (terrain) {
                            console.log('Switching to wireframe mode...');
                            terrain.setVisualizationMode('wireframe');
                            status.textContent = 'Wireframe mode';
                        }
                        break;
                }
            });

            // Render loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Update shader animation
                if (terrain && terrain.shaderMaterial && terrain.shaderMaterial.uniforms) {
                    terrain.update(0.016);
                }
                
                renderer.render(scene, camera);
            }
            animate();

            console.log('ðŸ”§ Shader fix test initialized');
        }

        init();
    </script>
</body>
</html>