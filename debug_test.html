<!DOCTYPE html>
<html>
<head>
    <title>Debug Test</title>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: monospace; }
        #log { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 10px; max-width: 400px; }
    </style>
</head>
<body>
    <div id="log">
        <h3>Debug Log</h3>
        <div id="status">Starting...</div>
    </div>

    <script src="https://unpkg.com/three@0.149.0/build/three.min.js"></script>

    <script>
        function log(message) {
            console.log(message);
            document.getElementById('status').innerHTML += '<br>' + message;
        }

        function init() {
            try {
                log('1. Starting init...');

                log('2. Creating scene...');
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000033);

                log('3. Creating camera...');
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = 5;

                log('4. Creating renderer...');
                const renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                log('5. Creating EXACT Oolite Cobra from vertex data...');

                // Exact Oolite Cobra vertex data from cobra3.json
                const cobraVertices = [
                    0, 2.769230842590332, 0,                    // 0: top front
                    2.9538462162017822, -0.0923076942563057, 6, // 1: right front
                    -2.9538462162017822, -0.0923076942563057, 6, // 2: left front
                    2.9538462162017822, -2.769230842590332, -6, // 3: right rear
                    -2.9538462162017822, -2.769230842590332, -6, // 4: left rear
                    -8.123077392578125, 1.8461538553237915, -6, // 5: left wing tip
                    -11.076923370361328, -0.5538461804389954, -2.4000000953674316, // 6: left wing rear
                    -12, -0.5538461804389954, -6,               // 7: left wing end
                    8.123077392578125, 1.8461538553237915, -6,  // 8: right wing tip
                    11.076923370361328, -0.5538461804389954, -2.4000000953674316, // 9: right wing rear
                    12, -0.5538461804389954, -6,                // 10: right wing end
                    0, 2.769230842590332, -6                    // 11: top rear
                ];

                // Create proper triangular faces manually (complete connectivity)
                const cobraFaces = [
                    // Front nose triangles
                    [0, 2, 1],    // front face

                    // Main hull to wing connections
                    [1, 8, 3],    // right front to wing
                    [2, 4, 5],    // left front to wing

                    // Wing tip triangles
                    [8, 9, 10],   // right wing tip
                    [5, 6, 7],    // left wing tip

                    // Main body triangles
                    [3, 8, 9],    // right mid section
                    [4, 6, 5],    // left mid section
                    [3, 9, 4],    // center rear connection
                    [4, 9, 6],    // rear left connection
                    [9, 10, 6],   // wing rear connection
                    [6, 10, 7],   // left wing rear

                    // Top surface triangles
                    [0, 1, 8],    // right front top
                    [0, 8, 11],   // right rear top
                    [0, 11, 5],   // left rear top
                    [0, 5, 2],    // left front top
                    [8, 10, 11],  // right wing top
                    [5, 11, 7],   // left wing top
                    [11, 10, 7],  // rear wing connection

                    // Bottom surface triangles
                    [1, 3, 9],    // right front bottom
                    [2, 6, 4],    // left front bottom
                    [1, 9, 8],    // right mid bottom
                    [2, 5, 6],    // left mid bottom

                    // Additional closure triangles
                    [3, 4, 9],    // rear center bottom
                    [9, 6, 10],   // wing connection bottom
                    [10, 6, 7],   // wing rear bottom

                    // Missing bottom center faces
                    [1, 2, 3],    // front bottom center
                    [2, 4, 3],    // center bottom connection
                ];

                // Create BufferGeometry
                const geometry = new THREE.BufferGeometry();

                // Convert face list to vertex array for non-indexed geometry
                const vertices = [];
                for (let face of cobraFaces) {
                    for (let vertexIndex of face) {
                        vertices.push(
                            cobraVertices[vertexIndex * 3],     // x
                            cobraVertices[vertexIndex * 3 + 1], // y
                            cobraVertices[vertexIndex * 3 + 2]  // z
                        );
                    }
                }

                geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));
                geometry.computeVertexNormals();

                // Create materials
                const solidMaterial = new THREE.MeshBasicMaterial({
                    color: 0x666666,
                    side: THREE.DoubleSide
                });

                const wireframeMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ff00,
                    wireframe: true
                });

                // Create meshes
                const cobra = new THREE.Group();
                const solidMesh = new THREE.Mesh(geometry, solidMaterial);
                const wireframeMesh = new THREE.Mesh(geometry, wireframeMaterial);

                cobra.add(solidMesh);
                cobra.add(wireframeMesh);

                // Scale down to see the full ship
                cobra.scale.setScalar(0.2);

                scene.add(cobra);

                // Use cobra instead of cube
                const cube = cobra;

                log('✅ EXACT Oolite Cobra created with ' + (vertices.length/3) + ' triangulated vertices!');

                log('6. Setting up manual controls...');

                // Manual rotation control
                let isMouseDown = false;
                let mouseX = 0, mouseY = 0;

                document.addEventListener('mousedown', (event) => {
                    isMouseDown = true;
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                document.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });

                document.addEventListener('mousemove', (event) => {
                    if (!isMouseDown) return;

                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;

                    cube.rotation.y += deltaX * 0.01;
                    cube.rotation.x += deltaY * 0.01;

                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                // Zoom control
                document.addEventListener('wheel', (event) => {
                    const zoomFactor = 1 + event.deltaY * 0.001;
                    camera.position.z *= zoomFactor;
                    camera.position.z = Math.max(1, Math.min(20, camera.position.z));
                });

                function animate() {
                    requestAnimationFrame(animate);
                    renderer.render(scene, camera);
                }

                animate();
                log('✅ Manual controls ready: Mouse drag to rotate, scroll to zoom');
                log('✅ SUCCESS: All working!');

            } catch (error) {
                log('❌ ERROR: ' + error.message);
                log('Stack: ' + error.stack);
            }
        }

        log('0. Page loaded, starting init...');
        setTimeout(init, 100); // Small delay to ensure DOM ready
    </script>
</body>
</html>